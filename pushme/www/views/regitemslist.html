<!DOCTYPE html>
<html>
<head>
	<title>Registered Items List | Push Me!</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../css/pure-min.css">
	<link rel="stylesheet" href="../css/extend-pure.css" type="text/css">
	<link rel="stylesheet" href="../css/style.css" type="text/css">
	<link rel="stylesheet" href="../css/side_menu.css" type="text/css">
	<link rel="stylesheet" href="../css/accordion.css" type="text/css">
	<link rel="stylesheet" href="../css/grids-responsive-min.css">
</head>
<body>
	<div id="layout">
	<!-- Menu toggle -->
	<a href="#menu" id="menuLink" class="menu-link">
	<!-- Hamburger icon -->
	<span></span>
	</a>
		<div id="menu" class="active">
			<div class="pure-menu pure-menu-open">
				<a class="pure-menu-heading" href="index.html">Top</a>
				<ul>
					<li><a href="submit.html">登録</a></li>
					<li><a href="decide.html">選択</a></li>
					<li><a href="listclips.html">クリップ</a></li>
					<li><a href="regitemslist.html">登録データ一覧</a></li>
					<li><a href="#">Coming Soon...</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="main">
		<div class="header">
			<h1>登録データ一覧</h1>
		</div>
		<div class="content">
			<h2 class="content-subhead">カテゴリを選んでください☻</h2>
			<form id="formId" class="pure-form">
				<select id="queryId">
					<option value="">ALL</option>
					<option value="dummy">dummy</option>
				</select>
				<input type="button" id="submitId" value="retrieve" class="pure-button pure-button-primary">
			</form>
			<div id="itemlist"></div>
			<div id="decision"></div>
		</div>
	</div>
	<script src="../js/jquery.min.js" type="text/javascript" ></script>
	<script src="../js/jquery-ui.min.js" type="text/javascript"></script>
	<script src="../js/side_menu.js"></script>
	<script type="text/javascript">

	$('#submitId').click(function(){
		var itemListHtml = "";
		var itemCount = 0;
		var queryData = {"tag" : $('#queryId').val()};
		console.log(queryData.tag);
	    var request = indexedDB.open("pushmeDB", 1);
	    request.onerror = function(e){
        	console.log("open error:", e);
	    };
	    request.onsuccess = function(e){
	        console.log("open success");
	        var db = e.target.result;
		    var transaction = db.transaction(["items"], "readonly");
		    // カテゴリに一致するもののみをフィルターする
		    var range = IDBKeyRange.only(queryData.tag);
		    var store = transaction.objectStore("items");
		    var index = store.index("category");

		    index.openCursor(range).onsuccess = function(e){
		        var cursorResult = e.target.result;

				itemListHtml += '<form name="itemlist" class="pure-form pure-form-aligned">';
				itemListHtml += '<div class="pure-g">';
				itemListHtml += '<span class="accordion">';
		        if(cursorResult){
		            console.log(cursorResult.value);

					var cate = cursorResult.value.category;
					var name = cursorResult.value.name;
					var desc = cursorResult.value.description;

					itemListHtml += '<div name="arrow" class="pure-u-1 pure-u-md-1-4">';
					itemListHtml += '<div name="card"><input type="checkbox" name="item" id="item' + itemCount + '">';
					itemListHtml += '<div name="category"><label for="item' + itemCount + '">' + name + '</label></div>';
					itemListHtml += '<input type="button" name="detail" value="詳細"></div>';
					itemListHtml += '<ul>';
					itemListHtml += '<li>名前:' + name + '</li>';
					itemListHtml += '<li>説明:' + desc + '</li></ul></div>';

					itemCount++;
		            cursorResult.continue();
				} else {
					if(itemCount == 0){
						itemListHtml = '<p name="itemlist">結果が見つかりませんでした。</p>';
					}
		        }
				itemListHtml += '</span></div></div>';
				itemListHtml += "</form>";
				$('#itemlist').html(itemListHtml);
	    	}
		    index.openCursor(range).onerror = function(e){
		        console.log("cusorRequest error: " + e.message);
		    }
	    };

//		makeAccordion();
//		makeIsChecked();
	});

	</script>
</body>
</html>

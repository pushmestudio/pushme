<!DOCTYPE html>
<html>
<head>
	<title>Registered Items List | Push Me!</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../css/pure-min.css">
	<link rel="stylesheet" href="../css/extend-pure.css" type="text/css">
	<link rel="stylesheet" href="../css/style.css" type="text/css">
	<link rel="stylesheet" href="../css/side_menu.css" type="text/css">
	<link rel="stylesheet" href="../css/jquery-ui.min.css" type="text/css">
	<link rel="stylesheet" href="../css/accordion.css" type="text/css">
	<link rel="stylesheet" href="../css/grids-responsive-min.css">
	<link rel="stylesheet" href="../css/smartphone.css" type="text/css">
</head>
<body>
	<div id="layout">
	<!-- Menu toggle -->
	<a href="#menu" id="menuLink" class="menu-link">
	<!-- Hamburger icon -->
	<span></span>
	</a>
		<div id="menu" class="active">
			<div class="pure-menu pure-menu-open">
				<a class="pure-menu-heading" href="index.html">Top</a>
				<ul>
					<li><a href="submit.html">登録</a></li>
					<li><a href="decide.html">選択</a></li>
					<li><a href="listclips.html">クリップ</a></li>
					<li><a href="regitemslist.html">登録データ一覧</a></li>
					<li><a href="#">Coming Soon...</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="main">
		<div class="header">
			<h1>登録データ一覧</h1>
		</div>
		<div class="content">
			<h2 class="content-subhead">カテゴリを選んでください☻</h2>
			<form id="formId" class="pure-form">
				<select id="queryId">
				</select>
				<input type="button" id="submitId" value="retrieve" class="pure-button pure-button-primary">
			</form>
			<div id="itemlist"></div>
		</div>

		<div id="requireAlart" title="警告" >必須項目を入力してください</div>
		<div id="editComplete" title="編集完了" >編集完了</div>
		<div id="editRegItem" title="登録内容編集">
			<form>
				<table>
					<tr>
						<td>*カテゴリ</td>
						<td><input type="text" id="newcate"></td>
					</tr>
					<tr>
						<td>*名前</td>
						<td><input type="text" id="newname"></td>
					</tr>
					<tr>
						<td>説明</td>
						<td><textarea id="newdesc" cols="20" rows="7" style="resize: none;"></textarea></td>
					</tr>
				</table>
			</form>
		</div>
		<div id="delItem" title="登録データの削除"></div>
	</div>
	<script src="../js/jquery.min.js" type="text/javascript" ></script>
	<script src="../js/jquery-ui.min.js" type="text/javascript"></script>
	<script src="../js/database.js" type="text/javascript"></script>
	<script src="../js/manipulateDOM.js" type="text/javascript"></script>
	<script src="../js/side_menu.js"></script>
	<script type="text/javascript">
	var oldname;
	var oldcate;
	var olddesc;
	var delcate;
	var delname;
	var deldesc;

	$('#requireAlart').dialog({
	    autoOpen: false,
	    resizable: false,
	    modal: true,
	    height: 200,
	    width: 250,
	    buttons: {
	        "OK": function(){
	            $(this).dialog("close");
	        }
	    }
	});

	$('#editRegItem').dialog({
		autoOpen: false,
		resizable: false,
		modal: true,
		height: 400,
		width: 300,
		buttons: {
			"この内容で編集する": function(){
				var newname = $('#newname').val();
				var newcate = $('#newcate').val();
				var newdesc = $('#newdesc').val();

				if( newname === "" || newcate === ""){
					$(this).dialog("close");
			    	$('#requireAlart').dialog("open");
			    } else {
					$(this).dialog("close");
					console.log("oldname is: " + oldname + ", newname is: " + newname);
					openDB().then(function(){　　　　　　　　　　　　　　　　　　　　　　　　
						updateItemtoDB(oldname, newcate, newname, newdesc).then(function(){
							updateStoredData(oldname, newcate, newname, newdesc);
							$('#newname').val("");
							$('#newcate').val("");
							$('#newdesc').val("");
		        			$('#editComplete').dialog("open");
						});
					});
				}
			},
			"キャンセル": function(){
				/*
				$('#newname').val("");
				$('#newcate').val("");
				$('#newdesc').val("");
				*/
				$(this).dialog("close");
			}
		}
	});

	$('#editComplete').dialog({
	    autoOpen: false,
	    resizable: false,
	    modal: true,
	    height: 200,
	    width: 250,
	    buttons: {
	        "OK": function(){
	            $(this).dialog("close");
	        }
	    }
	});
	
	$('#delItem').dialog({
		autoOpen: false,
		resizable: false,
		modal: true,
		height: 250,
		width: 300,
		buttons: {
			"削除": function(){
					$(this).dialog("close");
					openDB().then(function(){
						delItemFromDB().then(function(){
								updateStoredDataForDeleteProcess(delname);
						});
					});
			},
			"キャンセル": function(){
				$(this).dialog("close");
			}
		}
	});
	</script>
</body>
</html>
